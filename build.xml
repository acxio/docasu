<?xml version="1.0" encoding="utf-8"?>
<!--

    Copyright (C) 2008 Optaros, Inc. All rights reserved.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program. If not, see <http://www.gnu.org/licenses/>.
    
-->
<project name="docasu" basedir=".">
	
	<import file="build-module.xml"/>
	<import file="build-alfresco.xml"/>
	
	<!-- Do not modify the following properties -->
	<property name="ws.build.dir" value="${amp.build.dir}/config/alfresco/extension/templates/webscripts" />
	<property name="client.build.dir" value="${amp.build.dir}/docasu" />
	<property name="build.classes.dir" value="${build.dir}/classes" />
	<property name="source.main.dir" value="./src/main" />

	<!-- Patch an existing Alfresco war file to "deploy" our own AMP file -->
	<target name="patch-war" depends="docasu-module.package-amp" description="Install the AMP into the original Alfresco .war file">
		<java jar="${alfresco.mmt.jar.file}" fork="true">
			<arg line="install ${amp.file} ${alfresco.war.file} ${alfresco.mmt.options}"/>
		</java>
		<echo>AMP file ${amp.file} has been installed into ${alfresco.war.file}:</echo>
		<java jar="${alfresco.mmt.jar.file}" fork="true">
			<arg line="list ${alfresco.war.file}"/>
		</java>
	</target>
	
	<target name="deploy-war" depends="patch-war" description="Deploy the alfresco .war file after installing the AMP" >
		<!-- TODO: shutdown application server -->
		<copy file="${alfresco.war.file}" todir="${war.deployment.dir}"/>
		<!-- TODO: start up app server -->
		<echo>Copied WAR file to the deployent directory.</echo>
		<echo>You might want to delete the current webapp directory and restart your application server!</echo>
	</target>

	<target name="clean" description="Remove all created artifacts.">
		<delete dir="${target.dir}" />
	</target>
	
	<!-- targets used in development -->

	<target name="alfresco-start" depends="alfresco.start"/>
	<target name="alfresco-stop" depends="alfresco.stop"/>

</project>