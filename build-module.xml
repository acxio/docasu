<?xml version="1.0" encoding="utf-8"?>
<!--

    Copyright (C) 2008 Optaros, Inc. All rights reserved.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program. If not, see <http://www.gnu.org/licenses/>.
    
-->
<project name="docasu-module" default="package-amp" basedir=".">
	
	<import file="build-common.xml"/>
	
	<!-- include Alfresco jar files -->
	<!-- TODO: remove dependency on Alfresco SDK and import JARs into ./vendor ! -->
	<path id="class.path">
	    <fileset dir="${download.dir}/${alfresco.sdk}/" includes="**/*.jar"/>
	</path>
	
	<target name="init">
		<mkdir dir="${download.dir}"/>
		<mkdir dir="${build.dir}"/>
	</target>
	
	<!-- setup eclipse project -->
	<target name="download-sdk" depends="init">	
		<!-- download alfresco.sdk and unzip it -->
		<get src="http://switch.dl.sourceforge.net/sourceforge/alfresco/${alfresco.sdk}.zip" dest="${download.dir}/${alfresco.sdk}.zip" usetimestamp="true" verbose="true"/> 	
		<get src="http://switch.dl.sourceforge.net/sourceforge/alfresco/alfresco-mmt-2.1.0.jar" dest="${download.dir}/alfresco-mmt.jar" usetimestamp="true" verbose="true"/> 	
		<unzip src="${download.dir}/${alfresco.sdk}.zip" dest="${download.dir}/${alfresco.sdk}" overwrite="false"/>	
	</target>	
	
	<target name="copy-ressources" depends="init">
		<copy todir="${build.dir}">
			<fileset dir="${source.dir}/main/java">
				<include name="**/*"/>
				<exclude name="**/*.java"/>
			</fileset>
		</copy>
	</target>	

	<target name="compile" depends="init, download-sdk, copy-ressources">
		<javac destdir="${build.dir}"
			classpathref="class.path"
			srcdir="${source.dir}/main/java"
			target="1.5"
			fork="true"
			encoding="UTF-8"
		/>
	</target>

	<!-- Generate Alfresco Module Package (AMP) file for easy installation -->
	<target name="package-amp" depends="compile" description="Bundle the Custom UI functionality into an Alfresco Module Package (AMP) file.">
	
		<delete dir="${amp.dir}" />
		<delete file="${amp.file}" />
	
		<copy todir="${amp.dir}">
			<fileset dir="module" />
		</copy>
		<copy todir="${amp.dir}/config">
			<fileset dir="${build.dir}" />
		</copy>
		<copy todir="${amp.dir}/config/alfresco/extension">
			<fileset dir="${source.dir}/main/resources" />
		</copy>
		<copy todir="${amp.dir}/config/alfresco/extension/templates/webscripts" >
			<fileset dir="${source.dir}/main/webscripts" />
		</copy>
		
		<replace file="${amp.dir}/docasu/docasu.js"  token="@VERSION@" value="${docasu.version}"/>
		<replace file="${amp.dir}/module.properties" token="@VERSION@" value="${docasu.version}"/>

		<zip basedir="${amp.dir}" destfile="${amp.file}"/>
		<echo>AMP file ${amp.file} has been created.</echo>

	</target>
			
</project>